version: '3'
services:
  latipe-product-service:
    image: 0353486363/latipe-product-service:latest
    environment:
      SPRING_DATA_MONGODB_URI: mongodb://mongo:27017/
      RABBIT_MQ_HOST: rabbitmq
      EUREKA_HOST: latipe-discovery-server-service
      GATE_WAY_HOST: latipe-api-gateway-service
    networks:
      - latipe-network

  latipe-user-service:
    image: 0353486363/latipe-user-service:latest
    environment:
      SPRING_DATA_MONGODB_URI: mongodb://mongo:27017/
      RABBIT_MQ_HOST: rabbitmq
      EUREKA_HOST: latipe-discovery-server-service
      GATE_WAY_HOST: latipe-api-gateway-service
    ports:
      - "8381:8381"
    networks:
      - latipe-network

  latipe-payment-service:
    image: 0353486363/latipe-payment-service:latest
    environment:
      SPRING_DATA_MONGODB_URI: mongodb://mongo:27017/
      RABBIT_MQ_HOST: rabbitmq
      EUREKA_HOST: latipe-discovery-server-service
      GATE_WAY_HOST: latipe-api-gateway-service
    networks:
      - latipe-network

  latipe-search-service:
    image: 0353486363/latipe-search-service:latest
    environment:
      SPRING_DATA_MONGODB_URI: mongodb://mongo:27017/
      RABBIT_MQ_HOST: rabbitmq
      EUREKA_HOST: latipe-discovery-server-service
      GATE_WAY_HOST: latipe-api-gateway-service
      URL_ELASTIC: elastic-search:9200
    networks:
      - latipe-network

  latipe-auth-service:
    image: 0353486363/latipe-auth-service:latest
    environment:
      SPRING_DATA_MONGODB_URI: mongodb://mongo:27017/
      RABBIT_MQ_HOST: rabbitmq
      EUREKA_HOST: latipe-discovery-server-service
      GATE_WAY_HOST: latipe-api-gateway-service
    networks:
      - latipe-network

  latipe-store-service:
    image: 0353486363/latipe-store-service:latest
    environment:
      SPRING_DATA_MONGODB_URI: mongodb://mongo:27017/
      RABBIT_MQ_HOST: rabbitmq
      EUREKA_HOST: latipe-discovery-server-service
      GATE_WAY_HOST: latipe-api-gateway-service
    networks:
      - latipe-network

  latipe-rating-service:
    image: 0353486363/latipe-rating-service:latest
    environment:
      SPRING_DATA_MONGODB_URI: mongodb://mongo:27017/
      RABBIT_MQ_HOST: rabbitmq
      EUREKA_HOST: latipe-discovery-server-service
      GATE_WAY_HOST: latipe-api-gateway-service
    networks:
      - latipe-network

  latipe-media-service:
    image: 0353486363/latipe-media-service:latest
    environment:
      SPRING_DATA_MONGODB_URI: mongodb://mongo:27017/
      RABBIT_MQ_HOST: rabbitmq
      EUREKA_HOST: latipe-discovery-server-service
      GATE_WAY_HOST: latipe-api-gateway-service
    networks:
      - latipe-network

  latipe-api-gateway-service:
    image: 0353486363/latipe-api-gateway-service:latest
    environment:
      SPRING_DATA_MONGODB_URI: mongodb://mongo:27017/
      RABBIT_MQ_HOST: rabbitmq
      EUREKA_HOST: latipe-discovery-server-service
      GATE_WAY_HOST: latipe-api-gateway-service
    networks:
      - latipe-network

  latipe-cart-service:
    image: 0353486363/latipe-cart-service:latest
    environment:
      SPRING_DATA_MONGODB_URI: mongodb://mongo:27017/
      RABBIT_MQ_HOST: rabbitmq
      EUREKA_HOST: latipe-discovery-server-service
      GATE_WAY_HOST: latipe-api-gateway-service
    networks:
      - latipe-network

  latipe-discovery-server-service:
    image: 0353486363/latipe-discovery-server-service:latest
    ports:
      - "8761:8761"
    networks:
      - latipe-network

  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: 123123@Dat
      MYSQL_DATABASE: backend_orders_service
    command: --default-authentication-plugin=mysql_native_password
    networks:
      - latipe-network

  rabbitmq:
    image: rabbitmq:3.12-management
    networks:
      - latipe-network

  redis:
    image: redis:latest
    networks:
      - latipe-network

  mongo:
    image: mongo:7.0.1-rc0
    networks:
      - latipe-network

  elastic-search:
    image: 0353486363/latipe-elastic-search-vietnamese:latest
    restart: on-failure
    ulimits:
      nofile:
        soft: 65536
        hard: 65536
      memlock:
        hard: -1
        soft: -1
    environment:
      ES_JAVA_OPTS: "-Xmx2g -Xms2g"
      bootstrap.memory_lock: "true"
      discovery.type: "single-node"
      xpack.security.enabled: "false"
    networks:
      - latipe-network

networks:
  latipe-network:
    driver: bridge
